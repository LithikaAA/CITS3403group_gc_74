{% extends "base.html" %}
{% block title %}Upload Dashboard | VibeShare{% endblock %}

{% block content %}
<div class="w-full max-w-7xl mx-auto px-8 py-8">

  <!-- Breadcrumb -->
  <nav class="text-sm font-semibold mb-6" aria-label="Breadcrumb">
    <ol class="list-none p-0 inline-flex">
      <li class="flex items-center text-blue-500">
        <a href="{{ url_for('index.home') }}" class="text-gray-700">Home</a>
        <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
      </li>
      <li class="flex items-center">
        <span class="text-gray-600">Upload</span>
      </li>
    </ol>
  </nav>

  <!-- Greeting and Action -->
  <div class="lg:flex justify-between items-center mb-6">
    <p class="text-2xl font-semibold mb-2 lg:mb-0">Welcome back, {{ username }}!</p>
  </div>

  <!-- Banner Image -->
  <div class="rounded-xl overflow-hidden mb-10">
    <img src="{{ url_for('static', filename='img/banner.png') }}" alt="Banner" class="w-full h-48 object-cover shadow-lg">
  </div>

  <!-- Stats Cards -->
  <div class="flex flex-wrap -mx-3 mb-20">
    <div class="w-1/2 xl:w-1/4 px-3">
      <div class="w-full bg-white border text-blue-400 rounded-lg flex items-center p-6 mb-6 xl:mb-0">
        <svg class="w-16 h-16 fill-current mr-4 hidden lg:block" viewBox="0 0 20 20"><!-- playlist icon --></svg>
        <div class="text-gray-700">
          <p class="font-semibold text-3xl">{{ user_playlists|length }}</p>
          <p>Playlists Created</p>
        </div>
      </div>
    </div>
    <div class="w-1/2 xl:w-1/4 px-3">
      <div class="w-full bg-white border text-blue-400 rounded-lg flex items-center p-6 mb-6 xl:mb-0">
        <svg class="w-16 h-16 fill-current mr-4 hidden lg:block" viewBox="0 0 20 20"><!-- song icon --></svg>
        <div class="text-gray-700">
          <p class="font-semibold text-3xl">{{ recent_songs|length }}</p>
          <p>Songs Uploaded</p>
        </div>
      </div>
    </div>
    <div class="w-1/2 xl:w-1/4 px-3">
      <div class="w-full bg-white border text-blue-400 rounded-lg flex items-center p-6 mb-6 xl:mb-0">
        <svg class="w-16 h-16 fill-current mr-4 hidden lg:block" viewBox="0 0 20 20"><!-- artist icon --></svg>
        <div class="text-gray-700">
          <p class="font-semibold text-3xl">{{ artists|length }}</p>
          <p>Artists Added</p>
        </div>
      </div>
    </div>
    <div class="w-1/2 xl:w-1/4 px-3">
      <div class="w-full bg-white border text-blue-400 rounded-lg flex items-center p-6">
        <svg class="w-16 h-16 fill-current mr-4 hidden lg:block" viewBox="0 0 20 20"><!-- playcount icon --></svg>
        <div class="text-gray-700">
          <p class="font-semibold text-3xl">{{ total_playcount }}</p>
          <p>Total Playcount</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Playlists Section -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold">Playlists</h2>
    <div class="flex items-center space-x-2">
      <button id="new-playlist-btn" class="flex items-center space-x-2 bg-white border border-gray-200 shadow px-4 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
        <span class="text-xl font-bold">+</span>
        <span>New Playlist</span>
      </button>
      <button class="px-4 py-2 border rounded-lg text-sm font-medium">View All</button>
    </div>
  </div>
  <div class="flex space-x-4 mb-10">
    {% for playlist in user_playlists %}
    <div class="flex items-center bg-white rounded-xl shadow px-6 py-4 min-w-[220px]">
      {% if playlist.image %}
        <img src="{{ url_for('static', filename='img/' ~ playlist.image) }}" class="w-12 h-12 rounded mr-4" alt="">
      {% else %}
        <span class="text-3xl mr-4">{{ playlist.symbol or 'ðŸŽµ' }}</span>
      {% endif %}
      <div>
        <div class="font-bold">{{ playlist.name }}</div>
        <div class="text-xs text-gray-500">
          {% if playlist.items > 0 %}
            <span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 19V6l12-2v13"/><circle cx="6" cy="18" r="3" fill="currentColor"/><circle cx="18" cy="16" r="3" fill="currentColor"/></svg>{{ playlist.items }} items</span>
          {% else %}
            <span class="text-gray-400">No Items</span>
          {% endif %}
        </div>
      </div>
      <span class="ml-auto text-gray-400">&rarr;</span>
    </div>
    {% endfor %}
  </div>

  <!-- Inline Upload Panel (hidden by default) -->
  <div id="upload-panel" class="max-w-xl mx-auto bg-white rounded-xl shadow p-8 mb-10 relative">
    <button id="close-upload-panel" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
    <h2 class="text-2xl font-bold mb-6 text-center">Create New Playlist & Upload Song</h2>
    <form method="POST" action="{{ url_for('upload.upload_json') }}" enctype="multipart/form-data" class="space-y-6">
      <div>
        <label for="user_json" class="block font-medium mb-1">Upload Your Listening Data (.json)</label>
        <input type="file" id="file" name="user_json" accept=".json" required class="w-full border rounded px-3 py-2">
      </div>
    
      <button type="submit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition">
        Upload Listening Data
      </button>
    </form>
  </div>

  <!-- Recent Parts Section -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold">Recent Parts</h2>
    <button class="px-4 py-2 border rounded-lg text-sm font-medium">View All</button>
  </div>
  <div class="bg-white rounded-xl shadow p-4">
    <table class="w-full">
      <tbody>
        {% for song in recent_songs %}
        <tr class="border-b last:border-0">
          <td class="py-3 flex items-center">
            <!-- Use an icon or emoji for type -->
            <span class="text-2xl mr-3">
              {% if song.type == 'Orchestral work' %}ðŸŽ»{% elif song.type == 'Solo work' %}ðŸŽ¹{% elif song.type == 'Chamber work' %}ðŸŽ¼{% else %}ðŸŽµ{% endif %}
            </span>
            <div>
              <div class="font-semibold">{{ song.title }}</div>
              <div class="text-xs text-gray-500">{{ song.artist }}</div>
              <div class="text-xs {% if song.type == 'Orchestral work' %}text-blue-600{% elif song.type == 'Solo work' %}text-purple-600{% elif song.type == 'Chamber work' %}text-pink-600{% else %}text-gray-400{% endif %} font-semibold">{{ song.type }}</div>
            </div>
          </td>
          <td class="text-right text-gray-400">
            {{ song.part_type or '' }}
            <!-- Optionally add an icon for part type -->
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Example chart initialization (replace with your data)
  new Chart(document.getElementById('uploads-chart'), {
    type: 'line',
    data: {/* ... */},
    options: {/* ... */}
  });
  new Chart(document.getElementById('artists-chart'), {
    type: 'bar',
    data: {/* ... */},
    options: {/* ... */}
  });

  // Show/hide upload panel
  document.getElementById('new-playlist-btn').onclick = function() {
    document.getElementById('upload-panel').classList.remove('hidden');
  };
  document.getElementById('close-upload-panel').onclick = function() {
    document.getElementById('upload-panel').classList.add('hidden');
  };
</script>
{% endblock %}
