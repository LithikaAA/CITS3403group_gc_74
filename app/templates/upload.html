{% extends "base.html" %}
{% block title %}Upload Dashboard | VibeShare{% endblock %}

{% block content %}
<div class="w-full max-w-7xl mx-auto px-8 py-8">

  <!-- Greeting and Action -->
  <div class="lg:flex justify-between items-center mb-6 mt-10">
    <h1 class="text-5xl font-extrabold text-black drop-shadow-sm tracking-tight">
      Welcome back, {{ username }}!
    </h1>
  </div>
  <!-- Banner Image
  <div class="rounded-xl overflow-hidden mb-10">
    <img src="{{ url_for('static', filename='img/banner.jpg') }}" alt="Banner" class="w-full h-72 object-cover shadow-lg">
  </div> -->

  <div class="relative rounded-xl overflow-hidden mb-10 h-72 bg-gradient-to-r from-purple-500 via-pink-400 to-blue-400 flex items-center justify-center">
    <div class="text-white text-center">
      <h1 class="typewriter text-4xl sm:text-5xl font-extrabold tracking-wide"></h1>
    </div>
  </div>

  <!-- Stats Cards with Gradient Icons -->
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
  <div class="bg-white rounded-lg shadow flex items-center p-6">
    <div class="w-14 h-14 mr-4 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 flex items-center justify-center">
      <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="4" y="6" width="16" height="2" rx="1"/>
        <rect x="4" y="10" width="16" height="2" rx="1"/>
        <rect x="4" y="14" width="10" height="2" rx="1"/>
      </svg>
    </div>
    <div>
      <p class="font-bold text-4xl">{{ user_playlists|length }}</p>
      <p class="text-gray-600">Playlists Created</p>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow flex items-center p-6">
    <div class="w-14 h-14 mr-4 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 flex items-center justify-center">
      <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V5l12-2v12"/>
        <circle cx="6" cy="18" r="3"/>
      </svg>
    </div>
    <div>
      <p class="font-bold text-4xl">{{ recent_songs|length }}</p>
      <p class="text-gray-600">Songs Uploaded</p>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow flex items-center p-6">
    <div class="w-14 h-14 mr-4 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 flex items-center justify-center">
      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <rect x="9" y="2" width="6" height="12" rx="3"/>
        <path d="M12 14v7m-4 0h8"/>
      </svg>
    </div>
    <div>
      <p class="font-bold text-4xl">{{ artists|length }}</p>
      <p class="text-gray-600">Artists Added</p>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow flex items-center p-6">
    <div class="w-14 h-14 mr-4 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 flex items-center justify-center">
      <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="6,4 20,12 6,20 6,4" />
      </svg>
    </div>
    <div>
      <p class="font-bold text-4xl">{{ total_playcount }}</p>
      <p class="text-gray-600">Total Playcount</p>
    </div>
  </div>
</div>

  <!-- Upload JSON Panel -->
  <div class="bg-white rounded-xl shadow p-8 mb-10">
    <h2 class="text-2xl font-bold mb-6 text-center">Upload Playlist (JSON)</h2>
    <form method="POST" action="{{ url_for('upload.upload') }}" enctype="multipart/form-data" id="upload-form" class="flex flex-col items-center justify-center space-y-6">
      <label for="jsonFile" class="cursor-pointer w-20 h-20 rounded-full bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 flex items-center justify-center relative z-10">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M12 5v14m7-7H5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input type="file" id="jsonFile" name="jsonFile" accept=".json" required class="hidden">
        <p id="file-name" class="text-sm text-gray-500 mt-2"></p>
      </label>
      <button type="submit" id="upload-btn" class="w-full max-w-xs py-3 bg-gradient-to-r from-purple-400 to-pink-500 hover:brightness-110 text-white font-semibold rounded-full transition relative overflow-hidden">
        <span id="upload-text">Upload</span>
        <svg id="spinner" class="hidden absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
      </button>
    </form>
  </div>
</div>

<!-- Typewriter CSS -->
<style>
  @keyframes typing {
    0% { width: 0 }
    40% { width: 100% }
    60% { width: 100% }
    100% { width: 0 }
  }
  
  @keyframes blink {
    0%, 100% { border-color: transparent }
    50% { border-color: white }
  }
  
  .typewriter {
    display: inline-block;
    overflow: hidden;
    white-space: nowrap;
    border-right: 3px solid white;
    font-family: monospace;
    animation: typing 6s steps(30, end) infinite, blink 0.8s step-end infinite;
    width: 0;
  }
  
  .typewriter::before {
    content: "DISCOVER. VIBE. SHARE.";
  }
  </style>
{% endblock %}
  

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Panel close logic
    const closeBtn = document.getElementById('close-upload-panel');
    const panel = document.getElementById('upload-panel');
    if (closeBtn) {
      closeBtn.addEventListener('click', function () {
        panel.classList.add('hidden');
      });
    }

    // Upload interaction
    const fileInput = document.getElementById('jsonFile');
    const uploadForm = fileInput.closest('form');
    const uploadButton = uploadForm.querySelector('button[type="submit"]');

    // Show selected file name inside the + button
    fileInput.addEventListener('change', function () {
      const label = fileInput.previousElementSibling;
      if (fileInput.files.length > 0) {
        const fileName = fileInput.files[0].name;
        label.innerHTML = `<span class="text-white font-semibold text-sm truncate">${fileName}</span>`;
      } else {
        label.innerHTML = `
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 5v14m7-7H5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>`;
      }
    });

    // Prevent submit without file
    uploadForm.addEventListener('submit', function (e) {
      if (!fileInput.files.length) {
        e.preventDefault();
        showFlash("No file added!", "error");
        return;
      }

      // Show loading spinner
      uploadButton.disabled = true;
      uploadButton.innerHTML = `
        <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
      `;
    });

    // Allow Enter to submit if file selected
    fileInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && fileInput.files.length) {
        uploadForm.requestSubmit();
      }
    });

    // Flash message display
    function showFlash(message, category = "info") {
      const container = document.createElement('div');
      container.className = `
        fixed top-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow text-white font-semibold
        ${category === "error" ? "bg-red-500" : "bg-blue-500"}
      `;
      container.textContent = message;
      document.body.appendChild(container);

      setTimeout(() => {
        container.classList.add("opacity-0");
        setTimeout(() => container.remove(), 300);
      }, 3000);
    }
  });
</script>
{% endblock %}